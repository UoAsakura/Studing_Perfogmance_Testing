
 ! Расчет параметров интенсивности нагрузки. !


При нагрузочном тестировании задействованы виртуальные пользователи. 
Под расчетом параметров интенсивности нагрузки в общем виде подразумевается 
расчет количества виртуальных пользователей и количества операций, 
которое должен выполнить каждый пользователь, для обеспечения целевой нагрузки. В качестве исходных данных для расчетов используют целевую нагрузку и длительность операции.

Время выполнения одной операции можно измерить внутренними инструментами приложений для нагрузочного тестирования во время Smoke или Baseline тестов. Так как под нагрузкой время выполнения операции может увеличиться, измеренное время операции используют с запасом в несколько раз. Обычно коэффициент запаса равен 3 или 5. Для вычислений интенсивности нагрузки используют длительность операции уже с запасом. Например, измеренное время операции  – 40 секунд, запас  – x3. Значит длительность операции для расчетов 40*3=120 секунд.

От длительности операции зависит количество операций, которое может выполнить один виртуальный пользователь в час. Например, если длительность операции 120 секунд, то максимально 1 пользователь может выполнить 3600/120=30 операций в час.

Предположим, что необходимо обеспечить нагрузку 100 операций в час. Один виртуальный пользователь может выполнить максимум 30 операций в час. Трех виртуальных пользователей для обеспечения всей нагрузки не хватит. Значит для 100 операций потребуется 4 виртуальных пользователя.

Если все 4 виртуальных пользователя будут выполнять максимально возможное количество операций, то за час они выполнят 120 операций, а это больше требуемой нагрузки. Значит нужно сделать так, чтобы каждый виртуальный пользователь выполнил меньше операций в час, то есть выполнял их реже, с задержкой. Чтобы 4 пользователя за час выполнили 100 операций, каждый из них должен выполнить 100/4=25 операций.

Эти 25 операций должны выполняться равномерно в течение часа. В LoadRunner и JMeter используются разные подходы к тому, как задается задержка в выполнении операций виртуальным пользователем. В LoadRunner нужно указать pacing – время одного цикла, включающего собственно выполнение операции и задержку перед стартом следующей операции. Чтобы в час было выполнено 25 операций на один такой цикл нужно 3600/25=144 секунды.

В JMeter задается не время одного цикла, а количество таких циклов в минуту. Ели в час нужно выполнить 25 операций, то в минуту нужно выполнить 25/60=0,416667 операций.

Алгоритм расчета параметров интенсивности нагрузки

1) Рассчитать максимальное количество операций на 1 виртуального пользователя (VU) в час.

Максимальное количество операций на 1 VU в час = 3600 / Длительность операции, сек

2) Рассчитать количество виртуальных пользователей для обеспечения всей нагрузки, округлить до целого в большую сторону.

Количество VU = Нагрузка, операций в час / Максимальное количество операций на 1 VU в час

3) Рассчитать количество операций на 1 виртуального пользователя в час.

Количество операций на 1 VU в час = Нагрузка, операций в час / Количество VU

4) Расcчитать pacing для LoadRunner или количество операций на одного виртуального пользователя в минуту для JMeter.

Pacing = 3600 / Количество операций на 1 VU в час

Количество операций на 1 VU в минуту = Количество операций на 1 VU в час / 60


Пример 1.
Расчет параметров интенсивности нагрузки для ! LoadRunner !
Дано:
	При 100% профиля интенсивность составляет 2 000 операций в час.
	Время выполнения операции составляет 8 секунд
Вычислите:
	Сколько VU нужно использовать при 100% профиля?
	Какой будет Pacing?
1) 1 vu = 3600 / 8 = 450
2) Количество VU = 2000 / 450 = 4,44 = 5 (округляем)
3) Количество оперций на 1VU в час = 2000 / 5 = 400
4) Pacing = 3600 / 400 = 9


Пример 2.
Расчет параметров интенсивности нагрузки для ! JMeter !
Дано:
	При 100% профиля интенсивность составляет 3 000 операций в час.
	Время выполнения операции составляет 2 секунды
Вычислите:
	Сколько VU нужно использовать при 100% профиля?
	Сколько операций должен выполнять 1 VU в минуту?
1) 1 vu = 3600 / 2 = 1800
2) Количество VU = 3000 / 1800 = 1,66 = 2 (округляем)
3) Количество оперций на 1VU в час = 3000 / 2 = 1500
4) Pacing = 1500 / 60 = 25



 ! Расчет параметров интенсивности ступенчато возрастающей нагрузки !

В случае со ступенчато возрастающей нагрузкой порядок расчета интенсивности немного меняется. Во время теста мы не можем менять интенсивность работы виртуальных пользователей, но можем менять их количество. На каждой ступени можно добавить только целое количество виртуальных пользователей. Необходимо сделать так, чтобы добавление нескольких виртуальных пользователей увеличивало нагрузку точно на требуемое нам количество операций в час.

Как мы выяснили ранее, если длительность операции составляет 120 сек и требуется обеспечить нагрузку 100 операций в час, потребуется 4 виртуальных пользователя, которые должны выполнять по 25 операций в час. Для этого нужно задать pacing 180 сек или установить 0,416667 операций в минуту на пользователя.

Если нужно ступенчато увеличивать нагрузку, при таких настройках каждый дополнительный виртуальный пользователь увеличит нагрузку на 25 операций в час или на 25% профиля. Увеличить нагрузку на 10% или 20% за ступень не получится. Поэтому при расчете параметров интенсивности ступенчато возрастающей нагрузки отталкиваются не от основной нагрузки, а от дополнительной нагрузки за ступень.

Например, нужно начать со 100 операций и каждую ступень увеличивать нагрузку на 40% профиля, то есть на 40 операций в час. Один пользователь сможет выполнить максимум 30 операций в час. Значит каждую ступень нужно добавлять по 2 пользователя. При этом каждый должен выполнять только 20 операций в час. Далее обычным способом рассчитывается pacing или количество операций в минуту на пользователя.

Исходя из количества операций на одного пользователя в час для одной ступени рассчитывают стартовое количество пользователей. Для 100% профиля потребуется 100/20=5 виртуальных пользователей. То есть в начале потребуется 5 виртуальных пользователей, а потом на каждой ступени будет добавлено по 2 виртуальных пользователя.

Алгоритм расчета параметров интенсивности ступенчато возрастающей нагрузки

1) Рассчитать максимальное количество операций на 1 виртуального пользователя (VU) в час.

Максимальное количество операций на 1 VU в час = 3600 / Длительность операции, сек

2) Рассчитать количество виртуальных пользователей для обеспечения одной ступени нагрузки, округлить до целого в большую сторону.

Количество VU для 1 ступени = Нагрузка за 1 ступень, операций в час / 
			      Максимальное количество операций на 1 VU в час

3) Рассчитать количество операций на 1 виртуального пользователя в час.

Количество операций на 1 VU в час = Нагрузка за 1 ступень, операций в час / 
    				    Количество VU для 1 ступени

4) Расcчитать pacing для LoadRunner или количество операций на одного виртуального пользователя в минуту для JMeter.

Pacing = 3600 / Количество операций на 1 VU в час # Для LoadRunner

Количество операций на 1 VU в минуту = Количество операций на 1 VU в час / 60 # Для JMeter

5) Рассчитать количество виртуальных пользователей для обеспечения первоначальной нагрузки.

Количество VU в начале теста = Нагрузка в начале теста, операций в час /
			       Количество операций на 1 VU в час

 
Пример 1.
Расчет параметров интенсивности ступенчато возрастающей нагрузки для LoadRunner
Дано:
	При 100% профиля интенсивность составляет 10 000 операций в час.
	Время выполнения операции составляет 5 секунд
	Нужно провести тест, где сперва необходимо подать 100% профиля, а потом добавить ещё 10%
Вычислите:
	Сколько VU нужно использовать на первой ступени теста (100%)?
	Сколько добавится VU на второй ступени теста (110%)?
	Какой будет Pacing?

1) 3600 / 5 = 720
2) 10_000 * 10% / 720 = 1.38 = 2 кол-во VU для одной ступени нагрузки
3) 10_000 * 10% / 2 = 500 кол-во операций в час совершаемых VU
4) 3600 / 500 = 7.2    Pacing
5) 2 * (100% / 10%) = 20


Пример 2.
Расчет параметров интенсивности ступенчато возрастающей нагрузки для JMeter
Дано:
	При 100% профиля интенсивность составляет 3 000 операций в час.
	Время выполнения операции составляет 20 секунд
	Нужно провести тест, где сперва необходимо подать 100% профиля, а потом добавить ещё 20%
Вычислите:
	Сколько VU нужно использовать на первой ступени теста (100%)?
	Сколько добавится VU на второй ступени теста (120%)?
	Сколько операций в минуту должен выполнить 1 VU?

1) 3600 / 20 = 180
2) 3000 * 20% / 180 = 3.33 = 4
3) 3000 * 20% / 4 = 150
4) 150 / 60 = 2.5
5) 4 * (100% / 20%) = 20




























